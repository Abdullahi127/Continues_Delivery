name: CI/CD - Development Branch

on:
  push:
    paths:
      - ".github/workflows/dev.yml"
      - "core/**/*"
      - "adp/**/*"
      - "dp/**/*"
      - "oc/**/*"
      - "sim/**/*"

jobs:
  build:
    uses: Abdullahi127/Reusable_Workflows/.github/workflows/build.yml@main
    with:
      core-gradle-name: core
      core-directory-name: core
      adp-gradle-name: adp
      adp-directory-name: adp
      dp-gradle-name: dp
      dp-directory-name: dp
      oc-gradle-name: oc
      oc-directory-name: oc
      sim-gradle-name: sim
      sim-directory-name: sim
      main-branch-name: dev
      meta-data-branch-name: version

  # deployment:
  #   needs: build
  #   uses: Abdullahi127/Reusable_Workflows/.github/workflows/deployDevEnvs.yml@main
# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - name: checkout dev repo
#         uses: actions/checkout@v3
#         with:
#           ref: dev
#           fetch-depth: 0

#       - name: Setup java
#         uses: actions/setup-java@v3
#         with:
#           distribution: "temurin"
#           java-version: "17"
#           cache: "gradle"

#       - name: build core
#         run: |
#           chmod +x ./gradlew
#           ./gradlew core:setProjectVersion --projectVersion=1.0.0 --alias=core core:build

#       - name: upload adp
#         uses: actions/upload-artifact@v3
#         with:
#           name: deploy
#           path: ./core/build/libs
#           retention-days: 1

#   deployment:
#     needs: build
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/download-artifact@v3
#         id: download
#         with:
#           name: deploy
#           path: path/to/artifacts

#       - name: Display structure of downloaded files
#         run: ls -R
#         working-directory: path/to/artifacts

#       - name: "Echo download path"
#         run: |
#           echo "${{ steps.download.outputs.download-path }}"
#           regex="[0-9]\.[0-9]\.[0-9]\.jar"
#           for FILE in ${{ steps.download.outputs.download-path }}/*.jar; do
#               if [[ $FILE =~ $regex ]];
#                 then
#                 echo "$FILE";
#               fi
#           done;

# link: https://mkyong.com/spring/curl-post-request-examples/
# curl -F files=@$FILE "http://localhost:8080/componentManagement/api/components/"
